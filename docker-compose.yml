version: '2'
services:
  nx_php:
    build: ./php
    container_name: nx_php
    volumes:
      - ./source:/var/www/html
    links:
      - nx_memcached
      - nx_redis
      - nx_mysql
    environment: 
      - DEBUG=1
    ports:
      - 80:80
  nx_composer:
    build: ./composer
    container_name: nx_composer
    volumes_from:
      - nx_php
  nx_memcached:
    image: memcached:alpine
    container_name: nx_memcached
    mem_limit: 512m
    command: 'memcached -m 512m'
  nx_redis:
    image: redis:alpine
    container_name: nx_redis
  nx_mysql:
    build: ./mysql
    container_name: nx_mysql
    volumes: 
      - vol-mysql:/var/lib/mysql
    ports:
      - 3306:3306
    environment: 
      - MYSQL_ROOT_PASSWORD=root
  nx_node:
    build: ./nodejs
    command: 'npm start'
    working_dir: '/var/www/html'
    container_name: nx_node
    volumes_from: 
      - nx_php
volumes: 
  vol-mysql:
    driver: "local"

